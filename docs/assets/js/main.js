"use strict";const rsltContainer=document.querySelector(".js-searchContainer"),favContainer=document.querySelector(".js-favContainer"),searchBox=document.querySelector(".js-input"),clearBtn=document.querySelector(".js-clearFavBtn");let item,isFav,results=[],favList=[];function handleSearch(){getDataFromAPI()}function getDataFromAPI(){const e=searchBox.value;fetch("//api.tvmaze.com/search/shows?q="+e).then((function(e){return e.json()})).then((function(e){results=e,paintResults()}))}function paintResults(){let e="";for(0===results.length&&(e+='<div class="noResults"><img class="noResults__img" src="./assets/images/notFoundIcon.png" alt="Magnifying glass"/><p class="noResults__msg">Sorry! No results were found for your search. Please try typing something different.</p></div>'),item=0;item<results.length;item++){let t=results[item].show.id;isFav=favList.findIndex(e=>e.show.id===t),e+=-1!==isFav?`<li class="card highlightCard js-card" id="${item}" aria-label="Click to add favorite" title="Click to add favorite">`:`<li class="card js-card" id="${item}" aria-label="Click to add favorite" title="Click to add favorite">`,e+=`<h3 class="card__title">${results[item].show.name}</h3>`,null===results[item].show.image?e+='<img class="card__img" src="//via.placeholder.com/210x296/f0ffff/00008b/?text=No+image+available"/>':e+=`<img class="card__img" src="${results[item].show.image.medium}"/>`,null===results[item].show.rating.average?e+='<p class="card__rating">Rating: Not available</p>':e+=`<p class="card__rating">Rating: ${results[item].show.rating.average}</p>`,e+=`<a class="card__link" target="_blank" href="${results[item].show.url}">More info</a>`,e+="</li>"}rsltContainer.innerHTML=e,listenToCards()}function listenToCards(){const e=document.querySelectorAll(".js-card");for(const t of e)t.addEventListener("click",handleFav)}function handleFav(e){let t;t=parseInt(e.currentTarget.id);const a=results[t];isFav=favList.findIndex(e=>e.show.id===a.show.id),-1===isFav?(favList.push(results[t]),e.currentTarget.classList.add("highlightCard")):isFav>-1&&(favList.splice(isFav,1),e.currentTarget.classList.remove("highlightCard")),paintFav()}function paintFav(){let e="";for(item=0;item<favList.length;item++)e+=`<li class="favCard js-favCard" id="${item}" aria-label="Click to remove favorite" title="Click to remove favorite">`,e+=`<h3 class="favCard__title">${favList[item].show.name}</h3>`,null===favList[item].show.image?e+='<img class="favCard__img" src="//via.placeholder.com/210x296/f0ffff/00008b/?text=No+image+available"/>':e+=`<img class="favCard__img" src="${favList[item].show.image.medium}"/>`,e+="</li>";favContainer.innerHTML=e,setLocalStorage(),listenToFavs()}function listenToFavs(){const e=document.querySelectorAll(".js-favCard");for(const t of e)t.addEventListener("click",clearClickedFav)}function resetFavs(){favContainer.innerHTML="",favList.length=0,setLocalStorage(),paintResults()}function clearClickedFav(e){let t;t=parseInt(e.currentTarget.id),favList.splice(t,1),paintFav(),paintResults()}function setLocalStorage(){localStorage.setItem("favList",JSON.stringify(favList))}function getLocalStorage(){const e=localStorage.getItem("favList");if(null==e)favList=[];else{const t=JSON.parse(e);favList=t,paintFav()}}getLocalStorage(),searchBox.addEventListener("keyup",handleSearch),clearBtn.addEventListener("click",resetFavs);